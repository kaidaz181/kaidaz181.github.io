<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lag Controller</title>
<style>
  /* Minimal extracted styles (transparent background) */
  *{box-sizing:border-box}
  :root{--primary:#6366f1;--text:#eaf5ff}
  html,body{height:100%;margin:0;background:transparent;font-family:monospace, "Courier New", monospace;color:var(--text)}
  .panel{max-width:720px;margin:20px auto;padding:12px;border-radius:8px;background:transparent}
  h1{margin:0 0 12px;font-size:18px;font-weight:700}
  .controller{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .slider-wrap{flex:1;min-width:220px}
  input[type="range"]{width:100%}
  .value{min-width:64px;text-align:center;font-weight:700;font-size:16px}
  .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--primary);color:white;cursor:pointer;font-weight:700}
  .note{margin-top:12px;color:#b8c4c9;font-size:13px}
</style>
</head>
<body>
  <div class="panel">
    <h1>Lag Level Controller</h1>
    <div class="controller">
      <div class="slider-wrap">
        <input id="slider" type="range" min="0" max="100" step="1" value="0" />
      </div>
      <div class="value" id="val">0</div>
      <button id="writeNow" class="btn" style="display:none">Set</button>
    </div>
    <div class="note">Drag the slider and release (let go) to update the live display.</div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDzQlAqhCeytCLEYafboYGpFu6pY3Kv9WE",
  authDomain: "allforonemedia-9a7d8.firebaseapp.com",
  projectId: "allforonemedia-9a7d8",
  storageBucket: "allforonemedia-9a7d8.firebasestorage.app",
  messagingSenderId: "892787060584",
  appId: "1:892787060584:web:54a7a9d300138b3596f0dd",
  measurementId: "G-X02R5ELKED",
  databaseURL: "https://allforonemedia-9a7d8-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const slider = document.getElementById('slider');
const val = document.getElementById('val');

function writeLagLevel(v){
  const n = Math.max(0, Math.min(100, Math.round(Number(v) || 0)));
  set(ref(db, 'lag/level'), n).catch(err => {
    console.error('Write failed', err);
    alert('Failed to write to Firebase. Check DB rules and network.');
  });
}

// update numeric label while dragging (local preview)
slider.addEventListener('input', () => {
  val.textContent = slider.value;
});

// write value when user releases the slider
// 'change' fires when pointer is released after dragging
slider.addEventListener('change', () => {
  writeLagLevel(slider.value);
});

// for extra reliability on pointer/touch devices, also listen for pointerup/touchend on the slider element
slider.addEventListener('pointerup', () => { writeLagLevel(slider.value); });
slider.addEventListener('touchend', () => { writeLagLevel(slider.value); });

// keyboard users: write on Enter when focused
slider.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') writeLagLevel(slider.value);
});
</script>
</body>
</html>
